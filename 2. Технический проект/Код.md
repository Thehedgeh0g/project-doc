# UML Sequence Diagrams — Основные бизнес-процессы
## Система учёта библиотеки

В данном документе представлены **подробные UML Sequence Diagram**, описывающие
основные бизнес-процессы системы учёта библиотеки. Диаграммы демонстрируют
взаимодействие пользователей и компонентов системы во времени.

Диаграммы выполнены с использованием синтаксиса **Mermaid**.

---

## 1. Регистрация читателя

```mermaid
sequenceDiagram
    actor Reader as Читатель
    participant UI as Веб-интерфейс
    participant API as Backend API
    participant DB as База данных

    Reader->>UI: Заполнение формы регистрации
    UI->>API: POST /register
    API->>DB: Проверка уникальности email
    DB-->>API: Email свободен
    API->>DB: Создание учетной записи
    DB-->>API: OK
    API-->>UI: Регистрация успешна
```

---

## 2. Поиск и бронирование книги

```mermaid
sequenceDiagram
    actor Reader as Читатель
    participant UI as Веб-интерфейс
    participant API as Backend API
    participant DB as База данных

    Reader->>UI: Ввод параметров поиска
    UI->>API: GET /books?filter
    API->>DB: Поиск книг
    DB-->>API: Найденные книги
    API-->>UI: Результаты поиска

    Reader->>UI: Нажатие "Забронировать"
    UI->>API: POST /reservations
    API->>DB: Проверка доступности экземпляра
    DB-->>API: Экземпляр доступен
    API->>DB: Создание бронирования
    DB-->>API: OK
    API-->>UI: Бронирование подтверждено
```

---

## 3. Выдача книги библиотекарем

```mermaid
sequenceDiagram
    actor Librarian as Библиотекарь
    participant UI as Рабочее место библиотекаря
    participant API as Backend API
    participant DB as База данных
    participant MQ as AMQP брокер
    participant SMTP as SMPT Сервер

    Librarian->>UI: Подтверждение выдачи книги
    UI->>API: POST /loans
    API->>DB: Проверка бронирования
    DB-->>API: Бронирование найдено
    API->>DB: Создание записи о выдаче
    API->>DB: Установка срока возврата
    DB-->>API: OK
    API->>MQ: Событие «Книга выдана»
    API-->>UI: Выдача завершена
    MQ-->>API: Событие
    API-->>SMTP: Письмо
```

---

## 4. Возврат книги и начисление штрафа

```mermaid
sequenceDiagram
    actor Reader as Читатель
    actor Librarian as Библиотекарь
    participant UI as Интерфейс
    participant API as Backend API
    participant DB as База данных
    participant MQ as AMQP брокер
    participant SMTP as SMPT Сервер

    Reader->>Librarian: Возврат книги
    Librarian->>UI: Регистрация возврата
    UI->>API: POST /returns
    API->>DB: Получение данных о выдаче
    DB-->>API: Дата выдачи и срок возврата

    alt Срок возврата превышен
        API->>DB: Расчёт штрафа
        API->>DB: Создание записи о штрафе
        API->>MQ: Событие «Начислен штраф»
        MQ-->>API: Событие
        API-->>SMTP: Письмо
    end

    API->>DB: Обновление статуса книги
    DB-->>API: OK
    API-->>UI: Возврат завершён
```

---

## 5. Уведомление о приближении срока возврата

```mermaid
sequenceDiagram
    participant Scheduler as Планировщик
    participant API as Backend API
    participant DB as База данных
    participant MQ as AMQP брокер
    participant SMTP as SMPT Сервер

    Scheduler->>API: Запуск проверки сроков
    API->>DB: Поиск книг с истекающим сроком
    DB-->>API: Список выдач
    API->>MQ: Событие «Напоминание о возврате»
    MQ-->>SMTP: Уведомление о сроке возврата
```

---

## Заключение

Представленные UML Sequence Diagram подробно описывают ключевые бизнес-процессы
системы учёта библиотеки и могут использоваться в составе архитектурной и
проектной документации.
